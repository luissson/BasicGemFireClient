# BasicGemFireClient

# Project Description
This project provides a basic example of a TLS-enabled GemFire client that's intended to run in Kubernetes and communicate with a
GemFire for Kubernetes Cluster. See [Creating and Configuring an Encrypted GemFire Client in Java](https://tanzu.vmware.com/developer/data/gemfire/blog/tg4k8s-basic-client/) 

# Pre-req

This project uses GemFire 9.15.4 which is only available via the GemFire Commercial Repository. Please
refer to [Obtaining VMware GemFire from a Maven Repository
](https://docs.vmware.com/en/VMware-Tanzu-GemFire/9.15/tgf/GUID-getting_started-installation-obtain_gemfire_maven.html) 
to be able to pull GemFire 9.15.4.

# Build

To build the client, run from the root of the repository

`mvn clean compile assembly:single`

This produces a single executable jar file with dependencies included in the generated 'target' directory.
Then create a container image using the Dockerfile.

`docker build --tag gfclient .`

The container image will be used by a Kubernetes pod when deploying.

# Deploy

Pre-requisites:
* Kubernetes environment
* A running GemFire for Kubernetes cluster with TLS and a region named 'example-region'

Re-tag and push the generated image to the Docker repository of your choosing

`docker tag gfclient <<IMAGE-REPOSITORY>>/gfclient`

`docker push <<IMAGE-REPOSITORY>>/gfclient`


Create a certificate using the default GemFire for Kubernetes certificate issuer for the client. 
The Certificate will be generated by `cert-manager`, and the cert data will be placed in a Secret.
The client Pod will then reference the Secret and place the cert data on its file system.

First create the [Kubernetes Secret](./k8s/client-secret.yaml)

`kubectl apply -f ./k8s/client-secret.yaml`

then create the [Certificate](./k8s/client-cert.yaml).

`kubectl apply -f ./k8s/client-cert.yaml`

and lastly, create the [Java application Pod](./k8s/gfclient.yaml); 
substituting `<<IMAGE-REPOSITORY>>` where appropriate

`kubectl apply -f ./k8s/gfclient.yaml`

Once running, the client Pod will connect to the GemFire cluster, execute puts, followed by gets and then exit.
